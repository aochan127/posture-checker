<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ケンダル姿勢セルフチェック v3a（AI自動抽出・改善版）</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Primary CDN (jsDelivr) -->
  <script id="mp-pose" src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469404/pose.min.js"></script>
  <script id="mp-draw" src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.5.1675469414/drawing_utils.min.js"></script>
  <script>
    // Fallback to unpkg if primary fails to load within 3s
    window.addEventListener('load', () => {
      setTimeout(() => {
        if (!window.Pose) {
          const alt1 = document.createElement('script');
          alt1.src = 'https://unpkg.com/@mediapipe/pose@0.5.1675469404/pose.min.js';
          document.head.appendChild(alt1);
          const alt2 = document.createElement('script');
          alt2.src = 'https://unpkg.com/@mediapipe/drawing_utils@0.5.1675469414/drawing_utils.min.js';
          document.head.appendChild(alt2);
          console.warn('Primary CDN failed; switched to unpkg.');
        }
      }, 3000);
    });
  </script>
</head>
<body>
  <header>
    <h1>ケンダル姿勢セルフチェック v3a</h1>
    <p>AIが5点（耳・肩・大転子・膝・外果）を自動抽出。必要に応じて手動修正できます。</p>
  </header>

  <main>
    <section class="controls">
      <div class="file-controls">
        <label class="btn">
          画像を読み込む
          <input id="fileInput" type="file" accept="image/*" hidden />
        </label>
        <button id="aiBtn" class="btn-primary" disabled>AIで自動抽出</button>
        <button id="clearBtn" class="btn-secondary">リセット</button>
      </div>

      <div class="edit-controls">
        <div class="group">
          <label>鉛直線X: <input id="plumbX" type="number" min="0" value="0" /></label>
          <button id="centerPlumbBtn" class="btn-secondary">中央に置く</button>
          <label class="checkbox"><input type="checkbox" id="togglePlumb" checked> 鉛直線を表示</label>
        </div>

        <div class="group">
          <label>ランドマーク選択：</label>
          <div class="lm-picker">
            <label><input type="radio" name="lm" value="0" checked> ①耳</label>
            <label><input type="radio" name="lm" value="1"> ②肩</label>
            <label><input type="radio" name="lm" value="2"> ③大転子</label>
            <label><input type="radio" name="lm" value="3"> ④膝</label>
            <label><input type="radio" name="lm" value="4"> ⑤外果</label>
          </div>
        </div>

        <div class="group">
          <label>検出サイド：</label>
          <select id="sideSelect">
            <option value="auto" selected>自動</option>
            <option value="left">左側</option>
            <option value="right">右側</option>
          </select>
        </div>
      </div>
    </section>

    <section class="canvas-wrap">
      <div class="canvas-col">
        <canvas id="canvas" width="720" height="960"></canvas>
      </div>
      <aside class="results">
        <h3>結果</h3>
        <div id="metrics" class="metrics"></div>
        <div id="classification" class="classification"></div>
        <details open>
          <summary>診断・ログ</summary>
          <pre id="log" class="logbox">準備中…</pre>
        </details>
      </aside>
    </section>
  </main>

  <footer>
    <p>© 2025 AORC / Posture Checker (client-side only)</p>
  </footer>

  <script src="script.js"></script>
</body>
</html>
